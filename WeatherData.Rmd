---
title: "WeatherData"
author: "Sagar Ganapaneni, Vikramjeet Singh"
date: "February 20, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
library(dplyr)
library(tidyr)
library(data.table) 

# setting path of folder for files
filepath <- "./daily01/2017"

# creating a function to append filename to file data
add_filename <- function(x) {
        file <- fread(x)
        file$filename <- x
        file
        }
# creating a function to bind data of all files in a single file called "allfiles"
mergefile <- function(filepath){
        filenames=list.files(path=filepath, full.names=TRUE, pattern = "\\.txt$")
        allfiles <- rbindlist(lapply(filenames, fil))
        }
allfiles = mergefile(filepath)

# extracting YEAR, STATE, AREA columns from file name 
allfiles <- separate(data=allfiles, col=filename, into=c("a","area","c"), sep="_")
allfiles <- separate(data=allfiles, col=a, into=c("code","year","state"), sep="-")
allfiles <- allfiles[,-c("code","c")]

# creating .rda file for database 
save(allfiles, file = "database.rda")

# naming columns
names(allfiles) <- c(as.character(headers[[2]]), c("YEAR", "STATE", "AREA"))

# removing columns 1(WBANNO) and 3(CRX_VN)
# look for other columns to be removed for e.g. columns with missing data have lowest possible integer
allfiles <- allfiles[, -c("WBANNO","CRX_VN")]

```

